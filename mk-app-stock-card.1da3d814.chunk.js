webpackJsonp([6],{1847:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i,o=n(2),u=r(o),c=n(55),d=r(c),f=n(5),s=r(f),l=n(10),m=r(l),p=n(8),h=r(p),v=n(9),g=r(v),w=n(0),y=(r(w),n(252)),x=n(684),C=r(x),k=(a=(0,y.wrapper)(C.default))(i=function(e){function t(){return(0,s.default)(this,t),(0,h.default)(this,(t.__proto__||(0,d.default)(t)).apply(this,arguments))}return(0,g.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){return this.props.monkeyKing((0,u.default)({},this.props,{path:"root"}))}}]),t}(w.Component))||i;t.default=k,e.exports=t.default},1848:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new y.action(e),n=P.default.actionCreator((0,o.default)({},e,{metaAction:t})),r=new _((0,o.default)({},e,{metaAction:t,extendAction:n})),a=(0,o.default)({},t,n.gridAction,r);return t.config({metaHandlers:a}),a}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=r(i),u=n(7),c=r(u),d=n(567),f=r(d),s=n(568),l=r(s),m=n(5),p=r(m),h=n(10),v=r(h);t.default=a;var g=n(0),w=r(g),y=n(252),x=n(605),C=r(x),k=n(11),R=r(k),A=n(72),b=n(1987),P=r(b),_=function(){function e(t){var n=this;(0,p.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.extendAction.gridAction.onInit({component:t,injections:r}),n.component=t,n.injections=r,r.reduce("init"),n.load()},this.load=(0,l.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.stock.init({id:n.component.props.stockId});case 2:t=e.sent,n.injections.reduce("load",t);case 4:case"end":return e.stop()}},e,n)})),this.prev=(0,l.default)(f.default.mark(function e(){var t,r;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.stock.prev(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.next=(0,l.default)(f.default.mark(function e(){var t,r;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.metaAction.gf("data.form.id"),e.next=3,n.webapi.stock.next(t);case 3:r=e.sent,r&&n.injections.reduce("setForm",r);case 5:case"end":return e.stop()}},e,n)})),this.add=function(){n.injections.reduce("setForm")},this.save=(0,l.default)(f.default.mark(function e(){var t,r,a,i;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.metaAction.gf("data.form").toJS(),r=n.checkSave(t),!(r.length>0)){e.next=5;break}return n.metaAction.toast("error",w.default.createElement("ul",{style:{textAlign:"left"}},r.map(function(e){return w.default.createElement("li",null,e)}))),e.abrupt("return");case 5:if(!t.id&&0!=t.id){e.next=12;break}return e.next=8,n.webapi.stock.update(t);case 8:a=e.sent,a&&(n.metaAction.toast("success","保存存货成功"),n.injections.reduce("setForm",a)),e.next=16;break;case 12:return e.next=14,n.webapi.stock.create(t);case 14:i=e.sent,i&&(n.metaAction.toast("success","保存存货成功"),n.injections.reduce("setForm",i));case 16:case"end":return e.stop()}},e,n)})),this.tabChange=function(e){n.metaAction.sf("data.other.tabKey",e)},this.categoryChange=function(e){var t=n.metaAction.gf("data.other.categories"),r=t.find(function(t){return t.get("id")==e});n.metaAction.sf("data.form.category",r)},this.pricingModeChange=function(e){var t=n.metaAction.gf("data.other.pricingModes"),r=t.find(function(t){return t.get("id")==e});n.metaAction.sf("data.form.pricingMode",r)},this.getTypeDropdownChildren=function(e){if(e)return{_isMeta:!0,value:R.default.tree.map(e,"children","",function(e){return{name:e.id,component:"TreeSelect.TreeNode",key:e.id,title:e.name,value:e.id,children:e.children}})}},this.typeChange=function(e){var t=n.metaAction.gf("data.other.types").toJS(),r=R.default.tree.find(t,"children",function(t){return t.id==e});n.metaAction.sf("data.form.type",(0,A.fromJS)(r))},this.typeFocus=(0,l.default)(f.default.mark(function e(){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,n)})),this.addType=(0,l.default)(f.default.mark(function e(){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,n)})),this.getImg=function(){return img},this.taxRateChange=function(e){var t=n.metaAction.gf("data.other.taxRates"),r=t.find(function(t){return t.get("id")==e});n.metaAction.sf("data.form.taxRate",r)},this.meaUnitChange=function(e){var t=n.metaAction.gf("data.other.meaUnits"),r=t.find(function(t){return t.get("id")==e});n.metaAction.sf("data.form.meaUnit",r)},this.meaUnitFocus=(0,l.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.webapi.meaUnit.query();case 2:t=e.sent,n.metaAction.sf("data.other.meaUnits",(0,A.fromJS)(t));case 4:case"end":return e.stop()}},e,n)})),this.addMeaUnit=(0,l.default)(f.default.mark(function e(){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.addUnit("data.form.meaUnit");case 1:case"end":return e.stop()}},e,n)})),this.addMeaUnit4UnitGird=function(e){return(0,l.default)(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.addUnit("data.form.units."+e+".unit");case 1:case"end":return t.stop()}},t,n)}))},this.addMeaUnit4PriceGird=function(e){return(0,l.default)(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.addUnit("data.form.prices."+e+".unit");case 1:case"end":return t.stop()}},t,n)}))},this.addMeaUnit4barcodeGird=function(e){return(0,l.default)(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.addUnit("data.form.barcodes."+e+".unit");case 1:case"end":return t.stop()}},t,n)}))},this.addUnit=function(){var e=(0,l.default)(f.default.mark(function e(t){var r,a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.config.apps["mk-app-mea-unit-card"]){e.next=2;break}throw"依赖mk-app-mea-unit-card app,请使用mk clone mk-app-mea-unit-card命令添加";case 2:return e.next=4,n.metaAction.modal("show",{title:"新增",children:n.metaAction.loadApp("mk-app-mea-unit-card",{store:n.component.props.store})});case 4:if(!(r=e.sent)){e.next=10;break}return e.next=8,n.webapi.meaUnit.query();case 8:a=e.sent,n.metaAction.sfs((0,c.default)({"data.other.meaUnits":(0,A.fromJS)(a)},t,(0,A.fromJS)(r)));case 10:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}(),this.imgChange=function(e){n.metaAction.sf("data.other.selectedImgIndex",e)},this.addImg=function(){n.metaAction.toast("error","静态网站未实现")},this.delImg=function(){n.injections.reduce("delImg")},this.addUnitRow=function(e){n.injections.reduce("addUnitRow",e.rowIndex+1)},this.delUnitRow=function(e){n.injections.reduce("delUnitRow",e.rowIndex)},this.addPriceRow=function(e){n.injections.reduce("addPriceRow",e.rowIndex+1)},this.delPriceRow=function(e){n.injections.reduce("delPriceRow",e.rowIndex)},this.addBarcodeRow=function(e){n.injections.reduce("addBarcodeRow",e.rowIndex+1)},this.delBarcodeRow=function(e){n.injections.reduce("delBarcodeRow",e.rowIndex)},this.unitsUnitChange=function(e){return function(t){var r=n.metaAction.gf("data.other.meaUnits"),a=r.find(function(e){return e.get("id")==t});n.metaAction.sf("data.form.units."+e+".unit",a)}},this.numberFormat=function(e,t,n){return e?t:R.default.number.format(t,n)},this.metaAction=t.metaAction,this.extendAction=t.extendAction,this.config=C.default.current,this.webapi=this.config.webapi}return(0,v.default)(e,[{key:"checkSave",value:function(e){var t=[];return e.code||t.push("存货编码不能为空!"),e.name||t.push("存货名称不能为空!"),t}}]),e}();e.exports=t.default},1849:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new f.reducer(e),n=h.default.reducerCreator((0,o.default)({},e,{metaReducer:t})),r=new v((0,o.default)({},e,{metaReducer:t}));return(0,o.default)({},t,n.gridReducer,r)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=r(i),u=n(5),c=r(u);t.default=a;var d=n(72),f=n(252),s=n(605),l=r(s),m=n(685),p=n(1987),h=r(p),v=function e(t){var n=this;(0,c.default)(this,e),this.init=function(e,t){var r=(0,m.getInitState)();return n.metaReducer.init(e,r)},this.load=function(e,t){var r=t.stock,a=t.stockCategories,i=t.pricingModes,o=t.stockTypes,u=t.taxRates,c=t.meaUnits;return e=r?n.metaReducer.sf(e,"data.form",(0,d.fromJS)(r)):n.metaReducer.sf(e,"data",(0,d.fromJS)((0,m.getInitState)().data)),e=n.metaReducer.sf(e,"data.other.categories",(0,d.fromJS)(a)),e=n.metaReducer.sf(e,"data.other.pricingModes",(0,d.fromJS)(i)),e=n.metaReducer.sf(e,"data.other.types",(0,d.fromJS)(o)),e=n.metaReducer.sf(e,"data.other.taxRates",(0,d.fromJS)(u)),e=n.metaReducer.sf(e,"data.other.meaUnits",(0,d.fromJS)(c)),n.metaReducer.gf(e,"data.form.barcodes")||(e=n.metaReducer.sf(e,"data.form.barcodes",(0,d.fromJS)([{}]))),e},this.setForm=function(e,t){return e=t?n.metaReducer.sf(e,"data.form",(0,d.fromJS)(t)):n.metaReducer.sf(e,"data.form",(0,d.fromJS)((0,m.getInitState)().data.form)),n.metaReducer.gf(e,"data.form.barcodes")||(e=n.metaReducer.sf(e,"data.form.barcodes",(0,d.fromJS)([{}]))),e},this.delImg=function(e){var t=n.metaReducer.gf(e,"data.form.imgs");if(!t||0==t.size)return e;var r=n.metaReducer.gf(e,"data.other.selectedImgIndex")||0;return e=n.metaReducer.sf(e,"data.form.imgs",t.remove(r)),e=n.metaReducer.sf(e,"data.other.selectedImgIndex",void 0)},this.metaReducer=t.metaReducer,this.config=l.default.current};e.exports=t.default},1892:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1893),i=r(a),o=n(1894),u=r(o);t.default={action:i.default,reducer:u.default},e.exports=t.default},1893:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),i=r(a),o=n(51),u=r(o),c=n(2),d=r(c),f=n(46),s=r(f),l=n(5),m=r(l),p=n(10),h=r(p),v=n(11),g=r(v),w=n(14),y=r(w),x=function(){function e(t){var n=this;(0,m.default)(this,e),this.onInit=function(e){var t=e.component,r=e.injections;n.component=t,n.injections=r},this.isSelectAll=function(e){if(n.option){"string"==typeof e&&e||(e=(0,s.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);return!(!t||0==t.size)&&t.every(function(t){return t.get(n.option[e].selectFieldName)})}},this.selectAll=function(e){return function(t){n.option&&("string"==typeof e&&e||(e=(0,s.default)(n.option)[0]),n.injections.reduce("selectAll",t.target.checked,e))}},this.getSelectedCount=function(e){if(n.option){"string"==typeof e&&e||(e=(0,s.default)(n.option)[0]);var t=n.metaAction.gf(n.option[e].path);if(!t||0==t.size)return 0;return t.filter(function(t){return!!t.get(n.option[e].selectFieldName)}).size}},this.mousedown=function(e){if(n.option){var t=g.default.path.findPathByEvent(e);if(!n.metaAction.isFocus(t))if(-1!=t.indexOf("cell.cell"))n.focusCell(n.getCellInfo(t),t);else{if(!n.metaAction.focusByEvent(e))return;setTimeout(n.cellAutoFocus,16)}}},this.gridKeydown=function(e){if(n.option){var t="";if(37!=e.keyCode&&39!=e.keyCode&&13!=e.keyCode&&108!=e.keyCode&&9!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode||(t=g.default.path.findPathByEvent(e))&&-1!=t.indexOf(",")){if(37==e.keyCode){if(!g.default.dom.cursorAtBegin(e))return;return void n.moveEditCell(t,"left")}if(39==e.keyCode||13==e.keyCode||108==e.keyCode||9==e.keyCode){if(!g.default.dom.cursorAtEnd(e))return;return void n.moveEditCell(t,"right")}return 38==e.keyCode?void n.moveEditCell(t,"up"):40==e.keyCode?void n.moveEditCell(t,"down"):void 0}}},this.cellAutoFocus=function(){g.default.dom.gridCellAutoFocus(n.component,".editable-cell")},this.getCellClassName=function(e,t,r){if(n.option){"string"==typeof r&&r||(r=(0,s.default)(n.option)[0]);var a=n.option[r].cellClassName,i=n.metaAction.isFocus(e)?a+" editable-cell":"";return t&&(i+=" "+a+"-"+t),i}},this.dateOpenChange=function(e){if(!e){var t=y.default.findDOMNode(n.component).querySelector(".editable-cell");if(t&&-1!=t.className.indexOf("datepicker")){t.querySelector("input").focus()}}},this.addRow=function(e){return function(t){n.injections.reduce("addRow",e,t.rowIndex+1)}},this.delRow=function(e){return function(t){n.injections.reduce("delRow",e,t.rowIndex)}},this.metaAction=t.metaAction,t.gridOption&&(this.option=t.gridOption)}return(0,h.default)(e,[{key:"getColNames",value:function(e){return this.option[e].getColNames(this.metaAction.gf)}},{key:"moveEditCell",value:function(e,t){var n=this.getCellInfo(e);this.moveCell(n,t,e)}},{key:"moveCell",value:function(e,t,n){var r=function(e,t,n){return!1},a=(0,s.default)(this.option),i=!0,o=!1,c=void 0;try{for(var f,l=(0,u.default)(a);!(i=(f=l.next()).done);i=!0){var m=f.value;-1!=n.indexOf(m)&&this.option[m].cellIsReadonly&&(r=this.option[m].cellIsReadonly)}}catch(e){o=!0,c=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw c}}var p=g.default.matrix.move(e.rowCount,e.colCount,{x:e.x,y:e.y},t);p.x===e.x&&p.y===e.y||(r(p,n,this.metaAction.gf)?this.moveCell((0,d.default)({},e,p),t,n):this.focusCell((0,d.default)({},e,p),n))}},{key:"focusCell",value:function(e,t){var n=(0,s.default)(this.option),r=!0,a=!1,o=void 0;try{for(var c,d=(0,u.default)(n);!(r=(c=d.next()).done);r=!0){var f=c.value;if(-1!=t.indexOf(f)){var l,m=this.getColPathPrefix(t,f);this.metaAction.sfs((l={"data.other.focusFieldPath":""+m+this.getColNames(f)[e.x]+".cell.cell,"+e.y},(0,i.default)(l,"data.other."+f+"ScrollToRow",e.y),(0,i.default)(l,"data.other."+f+"ScrollToColumn",e.x+1),l))}}}catch(e){a=!0,o=e}finally{try{!r&&d.return&&d.return()}finally{if(a)throw o}}setTimeout(this.cellAutoFocus,16)}},{key:"getColPathPrefix",value:function(e,t){return e.substring(0,e.indexOf(t))+t+".columns."}},{key:"getCellInfo",value:function(e){if(this.option){var t=g.default.path.parsePath(e),n=(0,s.default)(this.option),r=!0,a=!1,i=void 0;try{for(var o,c=(0,u.default)(n);!(r=(o=c.next()).done);r=!0){var d=o.value;if(-1!=e.indexOf(d)){var f=this.getColPathPrefix(e,d),l=this.metaAction.gf(this.option[d].path).size,m=this.getColNames(d).length,p=t.path.replace(f,"").replace(".cell.cell","").replace(/\s/g,"");return{x:this.getColNames(d).findIndex(function(e){return e==p}),y:Number(t.vars[0]),colCount:m,rowCount:l}}}}catch(e){a=!0,i=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}}}}]),e}();t.default=x,e.exports=t.default},1894:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(r),i=n(72),o=function e(t){var n=this;(0,a.default)(this,e),this.selectAll=function(e,t,r){if(!n.option)return e;var a=n.option[r].path,i=n.option[r].selectFieldName,o=n.metaReducer.gf(e,a);if(!o||0==o.size)return e;for(var u=0;u<o.size;u++)e=n.metaReducer.sf(e,a+"."+u+"."+i,t);return e},this.addRow=function(e,t,r){if(!n.option)return e;var a=n.option[t].path,o=n.option[t].emptyRow||{},u=n.metaReducer.gf(e,a);return u=u.insert(r,(0,i.Map)(o)),n.metaReducer.sf(e,a,u)},this.delRow=function(e,t,r){if(!n.option)return e;var a=n.option[t].path,o=n.metaReducer.gf(e,a);return-1==r?e:(o=o.remove(r),0==o.size&&(o=o.insert(r,(0,i.Map)({}))),n.metaReducer.sf(e,a,o))},this.metaReducer=t.metaReducer,t.gridOption&&(this.option=t.gridOption)};t.default=o,e.exports=t.default},1987:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(){return{unitGrid:{path:"data.form.units",selectFieldName:"selected",cellClassName:"mk-app-stock-card-cell",emptyRow:{},getColNames:function(e){return["unit","conversionRate","conversionDesc","isBase","isPu","isSa","isSt"]}},priceGrid:{path:"data.form.prices",selectFieldName:"selected",cellClassName:"mk-app-stock-card-cell",emptyRow:{},getColNames:function(e){return["unit","lastPuPrice","referPuPrice","lastSaPrice","retailPrice","firstTradePrice","secondTradePrice","thirdTradePrice","fourthTradePrice","fifthTradePrice","sixthTradePrice","servenTradePrice","eighthTradePrice","ninthTradePrice","tenthTradePrice"]}},barcodeGrid:{path:"data.form.barcodes",selectFieldName:"selected",cellClassName:"mk-app-stock-card-cell",emptyRow:{},getColNames:function(e){return["barcode","unit"]}}}}function i(e){return{gridAction:new f.default.action((0,c.default)({},e,{gridOption:a()}))}}function o(e){return{gridReducer:new f.default.reducer((0,c.default)({},e,{gridOption:a()}))}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),c=r(u),d=n(1892),f=r(d);t.default={actionCreator:i,reducerCreator:o},e.exports=t.default}});